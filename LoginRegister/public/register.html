<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediGo-Signup</title>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Arial", sans-serif;
      }
      a{
        text-decoration: none;
      }
      /*Below For NavBar*/
      .Logo {
        height: 3rem;
        width: 3rem;
        margin-left: 2rem;
        margin-right: 2rem;
      }
      #nav {
        background-color: #4caf50 !important;
      }
      .btn {
        width:6rem;
        font-weight: 600;
        background-color: white;
        color:#0D6DEF;
      }
      .btn:hover{
        background-color: lightgreen;
        color:black;
      }
      .main-signUp-container{
        display:flex;
        justify-content: center;
      }
      .signup-container {
        backdrop-filter: blur(15px);
        padding: 2rem;
        border-radius: 15px;
        border:none;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        margin-top:2rem;
        margin-bottom:2rem;
    }
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
      }

      h2 {
        text-align: center;
        margin-bottom: 1.5rem;
        color: black;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .form-group {
        margin-bottom: 1.2rem;
        position: relative;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        color: black;
        font-weight: 500;
      }

      input,
      select {
        width: 100%;
        padding: 0.8rem;
        background: rgba(51, 47, 47, 0.1);
        border: 1px solid black;
        border-radius: 5px;
        font-size: 1rem;
        color: black;
        transition: all 0.3s ease;
      }

      input::placeholder {
        color: black;
      }

      input:focus {
        outline: none;
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.5);
      }

      .file-input {
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px dashed rgba(255, 255, 255, 0.3);
      }

      button {
        width: 100%;
        padding: 1rem;
        background:#4caf50;
        color: black;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      button:hover {
        background: lightgreen;
      }

      .login-link {
        text-align: center;
        margin-top: 1.5rem;
        color: black;
      }

      .login-link a {
        color: blue;
        text-decoration: none;
        font-weight: 500;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }

      .error {
        color: red;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }

      .password-toggle {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: black;
      }

      .password-toggle:hover {
        color: white;
      }
      /*Footer Section*/
      .footer-container,.py-3{
        background-color: #4caf50;
      }
      .nav-link{
        color: black !important;
        font-weight: 600 !important;
      }
      .nav-link:hover {
        color:white !important;
      }
    </style>
  </head>
  <body>
    <nav id="nav" class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <img
            class="Logo"
            src="./Resources/pixelcut-export.png"
            alt="Medico-Logo"
          />
          <a href="login.html">
            <button class="btn" type="submit">
                <span>SignIn</span>
              </button>
          </a>
            </form>
          </div>
        </div>
      </nav>
    <div class="main-signUp-container">
        <div class="signup-container">
      <h2>Signup</h2>
      <form id="signupForm" action="/auth/register" method="POST">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" name="uname" required />
          <div class="error" id="usernameError"></div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required />
          <div class="error" id="emailError"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="pass1" required />
          <i class="fas fa-eye password-toggle" id="togglePassword"></i>
          <div class="error" id="passwordError"></div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input type="password" id="confirmPassword" name="pass2" required />
          <i class="fas fa-eye password-toggle" id="toggleConfirmPassword"></i>
          <div class="error" id="confirmPasswordError"></div>
        </div>
    

        <button type="submit">Signup</button>
      </form>

      <div class="login-link">
        Already have an account? <a href="./login.html">SignIn here</a>
      </div>
    </div>
    </div>
    <div class="footer-container">
        <footer class="py-3">
          <ul class="nav justify-content-center border-bottom pb-3 mb-3">
            <li class="nav-item"><a href="aboutus.html" class="nav-link px-2 " style="color: black;">About Us</a></li>
          </ul>
          <p class="text-center" style="color: black;">Â© 2025 Medigo. All Rights Reserved.</p>
        </footer>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("signupForm");

  const inputs = {
    username: document.getElementById("username"),
    email: document.getElementById("email"),
    password: document.getElementById("password"),
    confirmPassword: document.getElementById("confirmPassword"),
  };

  // Password toggle functionality
  document.getElementById("togglePassword").addEventListener("click", function () {
    togglePasswordVisibility(inputs.password, this);
  });

  document.getElementById("toggleConfirmPassword").addEventListener("click", function () {
    togglePasswordVisibility(inputs.confirmPassword, this);
  });

  function togglePasswordVisibility(input, toggleIcon) {
    input.type = input.type === "password" ? "text" : "password";
    toggleIcon.classList.toggle("fa-eye-slash");
  }

  // Validation functions
  function validateUsername(username) {
    if (!username) return "Username is required";
    if (username.length < 4) return "Username must be at least 4 characters";
    if (!/^[a-zA-Z0-9_]+$/.test(username)) return "Invalid characters";
    return "";
  }

  function validateEmail(email) {
    if (!email) return "Email is required";
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return "Invalid email format";
    return "";
  }

  function validatePassword(password) {
    if (!password) return "Password is required";
    if (password.length < 8) return "Minimum 8 characters";
    if (!/[A-Z]/.test(password)) return "Needs at least one uppercase letter";
    if (!/[0-9]/.test(password)) return "Needs at least one number";
    return "";
  }

  function validateConfirmPassword(password, confirmPassword) {
    if (!confirmPassword) return "Confirm password is required";
    if (password !== confirmPassword) return "Passwords do not match";
    return "";
  }

  // Form submission
  form.addEventListener("submit", function (e) {
    e.preventDefault();
    let isValid = true;

    const errors = {
      username: validateUsername(inputs.username.value.trim()),
      email: validateEmail(inputs.email.value.trim()),
      password: validatePassword(inputs.password.value.trim()),
      confirmPassword: validateConfirmPassword(
        inputs.password.value.trim(),
        inputs.confirmPassword.value.trim()
      ),
    };

    // Show errors in the UI
    Object.keys(errors).forEach((field) => {
      const errorElement = document.getElementById(`${field}Error`);
      errorElement.textContent = errors[field];
      if (errors[field]) isValid = false;
    });

    if (isValid) {
      
      form.submit(); // Submit form if everything is valid
    }
  //new code
  if (pass1 !== pass2) {
            alert("Passwords do not match!");
            return;
        }

        // Send data to the backend
        fetch("/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ uname, email, pass1 })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "error") {
                alert(data.message); // Show alert if email already exists
            } else {
                alert("Registration successful!");
                window.location.href = "/login.html"; // Redirect to login page
            }
        })
        .catch(error => console.error("Error:", error));
  });

  // Real-time validation
  inputs.username.addEventListener("input", () => {
    document.getElementById("usernameError").textContent = validateUsername(inputs.username.value.trim());
  });

  inputs.email.addEventListener("input", () => {
    document.getElementById("emailError").textContent = validateEmail(inputs.email.value.trim());
  });

  inputs.password.addEventListener("input", () => {
    document.getElementById("passwordError").textContent = validatePassword(inputs.password.value.trim());
  });

  inputs.confirmPassword.addEventListener("input", () => {
    document.getElementById("confirmPasswordError").textContent = validateConfirmPassword(
      inputs.password.value.trim(),
      inputs.confirmPassword.value.trim()
    );
  });
});
  



      /*
      const form = document.getElementById("signupForm");
      const inputs = {
        username: document.getElementById("username"),
        email: document.getElementById("email"),
        password: document.getElementById("password"),
        confirmPassword: document.getElementById("confirmPassword"),
        file: document.getElementById("file"),
        address: document.getElementById("address"),
        phone: document.getElementById("phone"),
      };

      // Password toggle functionality
      const togglePassword = document.getElementById("togglePassword");
      const toggleConfirmPassword = document.getElementById(
        "toggleConfirmPassword"
      );

      togglePassword.addEventListener("click", () => {
        const type =
          inputs.password.getAttribute("type") === "password"
            ? "text"
            : "password";
        inputs.password.setAttribute("type", type);
        togglePassword.classList.toggle("fa-eye-slash");
      });

      toggleConfirmPassword.addEventListener("click", () => {
        const type =
          inputs.confirmPassword.getAttribute("type") === "password"
            ? "text"
            : "password";
        inputs.confirmPassword.setAttribute("type", type);
        toggleConfirmPassword.classList.toggle("fa-eye-slash");
      });

      // Validation functions
      const validateUsername = (username) => {
        if (!username) return "Username is required";
        if (username.length < 4)
          return "Username must be at least 4 characters";
        if (!/^[a-zA-Z0-9_]+$/.test(username)) return "Invalid characters";
        return "";
      };

      const validateEmail = (email) => {
        if (!email) return "Email is required";
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return "Invalid email";
        return "";
      };

      const validatePassword = (password) => {
        if (!password) return "Password is required";
        if (password.length < 8) return "Minimum 8 characters";
        if (!/[A-Z]/.test(password)) return "Needs uppercase letter";
        if (!/[0-9]/.test(password)) return "Needs number";
        return "";
      };

      const validateConfirmPassword = (password, confirmPassword) => {
        if (password !== confirmPassword) return "Passwords mismatch";
        return "";
      };

      //Here i removed phone number validation code it is in medico-notepad file

      // File validation
      inputs.file.addEventListener("change", function (e) {
        const file = e.target.files[0];
        const errorElement = document.getElementById("fileError");

        if (file) {
          const allowedTypes = ["image/jpeg", "image/png"];
          if (!allowedTypes.includes(file.type)) {
            errorElement.textContent = "Only JPG/PNG allowed";
            this.value = "";
          } else {
            errorElement.textContent = "";
          }
        }
      });

      // Form submission
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        let isValid = true;

        const errors = {
          username: validateUsername(inputs.username.value.trim()),
          email: validateEmail(inputs.email.value.trim()),
          password: validatePassword(inputs.password.value.trim()),
          confirmPassword: validateConfirmPassword(
            inputs.password.value.trim(),
            inputs.confirmPassword.value.trim()
          ),
          phone: validatePhone(inputs.phone.value.trim()),
          address: inputs.address.value.trim() ? "" : "Address required",
          file: inputs.file.files.length ? "" : "File required",
        };

        Object.keys(errors).forEach((field) => {
          const errorElement = document.getElementById(`${field}Error`);
          errorElement.textContent = errors[field];
          if (errors[field]) isValid = false;
        });

        if (isValid) {
          form.reset();
          document
            .querySelectorAll(".error")
            .forEach((el) => (el.textContent = ""));
          alert("Signup successful!");
        }
      });

      // Real-time validation
      inputs.username.addEventListener("input", () => {
        document.getElementById("usernameError").textContent = validateUsername(
          inputs.username.value.trim()
        );
      });

      inputs.email.addEventListener("input", () => {
        document.getElementById("emailError").textContent = validateEmail(
          inputs.email.value.trim()
        );
      });

      inputs.password.addEventListener("input", () => {
        document.getElementById("passwordError").textContent = validatePassword(
          inputs.password.value.trim()
        );
      });

      inputs.confirmPassword.addEventListener("input", () => {
        document.getElementById("confirmPasswordError").textContent =
          validateConfirmPassword(
            inputs.password.value.trim(),
            inputs.confirmPassword.value.trim()
          );
      });

      inputs.phone.addEventListener("input", () => {
        document.getElementById("phoneError").textContent = validatePhone(
          inputs.phone.value.trim()
        );
      });*/
    </script>
  </body>
</html>